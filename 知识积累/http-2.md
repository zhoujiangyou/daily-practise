---
title: http1.1与http2
date: 2017-11-6 14:20:02
tags: http
---
http2.0的出现，相比较与http1.X，大幅度提升了web性能。在于http1.1完全语义兼容的基础上，进一步减少了网络延迟。

#### http1.0与http1.1比较  
1. 缓存处理：在http1.0中主要使用header里面的if-Modified-Since,Expires来作为缓存判断的标准，http1.1则引入了更多的缓存控制策略例如：Entity tag,if-Unmodified-Since,if-Match,if-none-match等更多可供选择的缓存头来控制缓存策略。  
2. 带宽优化及网络连接的使用：http1.0中存在一些浪费带宽的现象，例如客户端只是需要某个对象的一部分，而服务端却将整个对象送过来了，并且不支持断点续传的功能。http1.1则在请求头中引入了range头域，它允许只请求资源的某个部分，即返回码是206，这样就方便了开放者自由的选择以便于充分利用带宽和连接。  
3. 错误通知的管理：在http1.1中新增了24个错误状态响应码。如409表示请求的资源与资源当前状态发生冲突；410表示服务器上某个资源被永久性删除  
4. host头处理：http1.0中人物每台服务器都绑定一个唯一的ip地址，因此请求消息的url并没有传递主机名（hostname）。但是随着虚拟主机技术的发展，在一台物理服务器上可以存在多个虚拟主机，并且共享一个ip地址。http1.1的请求消息和响应消息都应支持host头域，且请求消息中如果没有host头域会报一个错误（400 Bad Request）  
5. 长连接：http1.1支持长连接和请求的流水线处理。在一个tcp连接上可以传送多个http请求和响应，减少了建立和关闭连接的消耗和延迟，在http1.1中默认开启connection：Keep-Alive，在一定程度上弥补了http1.0每次请求都要创建连接的缺点。    

#### http与https区别  
1. https协议需要到CA申请证书，一般免费证书很少，需要交费。  
2. http运行在tcp之上，所有的传输内容都是明文，https运行在ssl/tls之上，ssl/tls运行在tcp之上，所有传输的内容都是经过加密的。  
3. http与https用的是完全不同的连接方式，用的端口也不一样，前者是80后者是443  
4. https可以有效防止运营商劫持没解决了劫房劫持的一大问题。

#### SPDY http1.X的优化  
1. 降低延迟，针对http高延迟的问题，SPDY优雅的采取了多路复用。多路复用通过多个请求stream共享一个tcp连接的方式，解决了HOL blocking的问题，降低了延迟同时提高了带宽的利用率。  
2. 请求优先级，多路复用带来一个新的问题就是连接共享的基础之上可能会导致关键的请求被阻塞，SPDY允许给每一个request设置优先级，这样重要的请求就会优先得到相应。比如浏览器加载页面，首页的html内容应该优先展示，之后才是各种静态资源文件，脚本文件的加载，这样可以保证用户能第一时间看到网页内容。  
3. header压缩。http1.x的header很多时候都是重复多余的。选择合适的压缩算法可以减小包的大小和数量。  
4. 基于https的加密协议传输，大大提高的传输数据的可靠性。
5. 服务端推送，采用SPDY的网页。例如我的网页有一个style.css的请求，在客户端收到style.css的数据的同事，服务端会将style.js文件推送给客户端，当客户端再次尝试获取style.js的时候，就可以直接从缓存中获取，不需要在发送请求。  

#### http2.0与http1.X相比的新特性  
1. 新的二进制格式：http1.X的接续是基于文本。基于文本协议的格式解析存在天然缺陷，文本的表现形式有多样性，要做到健壮性考虑的场景必然很多，二进制则不同，只认0和1的组合。基于这种考虑http2.0协议解析决定采用二进制格式实现方便且健壮。
2. 多路复用：允许同事用过单一的http2连接发起多重请求-响应消息。在http1.1协议中，浏览器客户端在同一时间针对同一域名下面的请求有一定数量限制。超过限制数目会被阻塞。
单链接多资源的方式，减少服务端的链接压力内存占用更加少，链接吞吐量更加大。由于tcp链接的减少而使用网络拥塞状况得以改善，同时慢启动时间的减少，使拥塞和丢包的恢复速度更快。
3. 首部压缩（header compression）
http1.1并不支持http首部压缩，为此SPDY和http2应运而生，SPDY使用的是通用的DEFLATE算法，而http2使用了专门为首部压缩而设计的HPACK算法。  
4. 服务端推送，同spdf一样htp2.0也具有server push功能。
