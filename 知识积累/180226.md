---
title: http、tcp/ip、socket区别
date: 2018-02-26 13:58:02
tags: http
---

我们在传输数据时，可以只是用（传输层）tcp/ip协议，但是那样的话没有应用层，便无法识别数据内容。如果想要使传输的数据
有意义，则必须使用应用层协议。应用层协议很多，比如http、ftp、telnet等。也可以自己定义应用层协议。web使用http协议作为应用层协议  
一般我们平时说的最多的socket是指对TCP/IP协议的封装。socket本身不是协议，而是一个调用接口。通过socket我们才能使用TCP/IP协议。  
实际上socket跟TCP/Ip协议没有必然联系。socket编程接口在设计的时候，也就希望能适应其他的网络协议。 所以说socket的出现只是使得
程序员更加方便的使用TCP/IP协议栈而已，是对TCP/IP协议的抽象。从而形成了我们知道的一些最基本的函数接口。比如：create listen 
connect accept send read wreite等。  
TCP/IP知识一个协议栈，就想操作系统的运行机制一样，必须要具体实现，同事还要提供对外的操作接口。这个就像操作系统会提供标准的编程接口
比如win32编程接口一样。TCP/IP也要提供可以供程序员做网络开发所用的接口，这个就是socket编程接口。  
###面试笔试常考点  
####tcp三次握手：
第一次：建立连接时，客户端发送syn包（syn=j）到服务器，并进入syn_send状态，等待服务器确认。syn：同步序列编号（synchronize sequence number）  
第二次：服务器收到syn包，必须确认客户的syn（ack=j+1），同事自己也发送一个syn包（k），即syn+ack包。此时服务器进入syn_recv状态。  
第三次握手：客户端收到服务器的syn+ack包，向服务端发送确认包ack（ack=k+1），此包发送完毕，服务端与客户端进入
established状态，完成三次握手。
  
---
  
tcp报文格式如下图：
![tcp报文格式](http://blog.chinaunix.net/attachment/201304/7/22312037_1365321234nnNc.png)

1. 序号：seq序号，占位32，用来表示从tcp源端想目的端发送的字节流，发起方发送数据时对此进行标记。  
2. 确认序号：ack序号，占位32，只有ack标志位为1时，确认序号字段才有效。ack=seq+1.
3. 标志位：一共有六个标志位。
    3.1 urg：紧急指针有效  
    3.2 ack：确认序号有效  
    3.3 psh：接收方应该尽快将这个报文交给应用层  
    3.4 syn：发起一个连接  
    3.5 fin：关闭一个连接  

tcp三次握手过程中，客户端跟服务端将总发送三个包来确认连接。  
![tcp三次握手数据包](http://blog.chinaunix.net/attachment/201304/8/22312037_1365405910EROI.png)
第一次握手：客户端将标志位SYN置为1，随机产生一个值seq=J，并将该数据包发送给server，客户端进入SYN_SENT状态，等待服务端确认。  
第二次握手：服务端收到数据包后，由标志位SYN=1知道客户端请求建立连接，server将标志位SYN和ACk都置为1，确认应答包Ack=J+1，并随机产生一个
seq=k，并将该数据包发送给客户端确认连接请求。服务端进入SYN_RCVD状态。  
第三次握手：客户端收到确认后，检查Ack是否为J+1，ACK标志位是否为1，如果正确，则返回一个Ack=k+1，标志位Ack=1的包给服务端。服务端检查完毕
后，服务端与客户端都进入ESTABLISHED状态。完成三次握手后，client与server之间就可以进行传输数据了。  

#### tcp四次挥手  
由于tcp连接是全双工的，因此每个方向都必要要单独进行关闭。  
![tcp四次挥手](http://blog.chinaunix.net/attachment/201304/9/22312037_1365503104wDR0.png)  
第一次挥手：客户端发送一个FIN，用来关闭客户端与服务端的数据传送，客户端进入FIN_WAIT_1状态。  
第二次挥手：服务端收到FIN后，发送一个ACK给Client，确认序号为收到序号+1，服务端进入CLOSE_WAIT状态。   
第三次挥手：服务端发送一个FIN用来关闭服务端到客户端的数据传送，此时服务端进入LAST_ACK状态。  
第四次挥手：客户端收到FIN后，客户端进入TIME_WAIT状态，接着发送一条ACK给服务端，确认区号为收到序号+1，服务端进入closed状态，
完成四次挥手。

