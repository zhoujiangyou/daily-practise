---
title: redis相关知识
date: 2018-3-5 13:58:02
tags: redis
---

1. redis持久化：  
RDB持久化：redis在内存中的数据库记录定时DUMP到磁盘上面的RDB持久化。  
在指定的时间间隔内将内存中的数据集快照写入磁盘，实际操作是fork一个子进程，现将数据集写入临时文件，写入成功后在替换之前的文件，用二进制进行压缩存储。   
####优势：  
1. 一旦采用这种方式，那么整个redis数据库将只包含一个文件，这对于文件备份是非常完美的，可以通过自定义时间间隔来进行备份。并将备份文件
存储到其他介质上面。  
1. 性能最大化，在备份时fork子进程，避免服务进程进行IO操作。  
1. 相比于aof而言，在数据量很大的情况下。RDB在启动时占优势。   
####劣势：  
1. 想保证数据的高可用性，即最大限度的避免数据的丢失，rdb可能不行。在还没有完成写入磁盘的数据可能会没了。  
1. RDB是通过fork子进程来协助进行数据持久化工作，当数据集较大的时候，可能会导致整个服务器停止服务几百毫秒或者一秒。

AOF持久化：讲redis的操作日志已追加的方式写入文件。  
以日志的形式记录服务器所处理的每一个写、删除操作。查询操作不会记录，以文本的方式记录。  
####优势：  
1. 有更高的数据安全性，redis中定义了三种同步策略：每秒同步，每修改同步，和不同步。事实上每秒同步也是异步进行的。  
1. 由于是对日志文件的写入操作，追加写入append。所以在发生宕机情况时也不会损坏之前的文件。  
1. 格式清晰、易于理解的日志文件用于记录所有的修改操作，可以通过该文件完成数据的重建。  
####劣势：  
1. AOF文件在通常要大于RDB文件，RDB恢复大数据的时候比AOF速度要快。  
1. 根据同步策略的不同，AOF在运行效率上面往往会慢于RDB。  


常用配置相关：  
RDB持久化配置
Redis会将数据集的快照dump到dump.rdb文件中。此外，我们也可以通过配置文件来修改Redis服务器dump快照的频率，在打开6379.conf文件之后，我们搜索save，可以看到下面的配置信息：
save 900 1              #在900秒(15分钟)之后，如果至少有1个key发生变化，则dump内存快照。
save 300 10            #在300秒(5分钟)之后，如果至少有10个key发生变化，则dump内存快照。
save 60 10000        #在60秒(1分钟)之后，如果至少有10000个key发生变化，则dump内存快照。
AOF持久化配置
在Redis的配置文件中存在三种同步方式，它们分别是：
appendfsync always     #每次有数据修改发生时都会写入AOF文件。
appendfsync everysec  #每秒钟同步一次，该策略为AOF的缺省策略。
appendfsync no          #从不同步。高效但是数据不会被持久化。  

2. redis同步机制  
redis可以使用主从同步，从从同步。第一次同步时，主节点做一次bgsave，并同时将后续修改操作记录到内存buffer，待完成之后将rdb文件全量同步到复制节点，
复制节点接受完成后将rdb镜像加载到内存。加载完成后，在通知主节点将期间修改的操作记录同步到复制节点进行重放。这样就就完成了同步。


